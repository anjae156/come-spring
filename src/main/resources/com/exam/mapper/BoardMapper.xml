<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.exam.mapper.BoardMapper">
  
  	<select id="nextBoardNum" resultType="int">
  		SELECT IFNULL(MAX(num),0) +1 AS bnum FROM board2
  	</select>
  	
  	<insert id="insertBoard">
  		INSERT INTO board2 (num, username, passwd, subject, content, readcount, ip, reg_date, re_ref, re_lev, re_seq)
  		VALUES (#{num}, #{username}, #{passwd}, #{subject}, #{content}, #{readcount}, #{ip}, current_timestamp, #{reRef}, #{reLev}, #{reSeq})
  	</insert>
  	
  	<select id="getBoards" resultType="BoardVO">
  		SELECT *
  		FROM board2
  		<where>
  			<if test="search != null and search !=''">
  				subject LIKE CONCAT('%',#{search}, '%')
  			</if>
  		</where>
  		ORDER BY re_ref DESC, re_seq ASC
  		LIMIT #{pageSize} OFFSET #{startRow}
  		<!-- LIMIT #startRow, #{pageSize} -->
  	</select>
  	
  	<select id="getBoardCount" resultType="int">
  		SELECT COUNT(*)
  		FROM board2
  		<where>
  			<if test="search != null and search != ''">
  				subject LIKE CONCAT('%', #{search}, '%')
  			</if>
  		</where>
  	</select>
  	
  	<update id="updateReadcount">
  		UPDATE board2
  		SET readcount = readcount + 1
  		WHERE num = #{num}
  	</update>
  	
  	<select id="getBoard" resultType="BoardVO">
  		SELECT *
  		FROM board2
  		WHERE num = #{num}
  	</select>
  	
  </mapper>